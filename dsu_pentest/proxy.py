from flask import Flask, request, Response
import requests

app = Flask(__name__)

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>', methods=['GET', 'POST'])
def proxy(path):
    target_url = request.url.replace(request.host_url, '')  # Get the target URL
    if request.method == 'POST':
        print("\n\n\n\n got the post request:\n\n\n\n")
        print(request.form)
    # Forward the request to the target URL
    response = requests.request(
        method=request.method,
        url=target_url,
        headers={key: value for (key, value) in request.headers if key != 'Host'},
        data=request.get_data(),  # Include request data for POST requests
        cookies=request.cookies,
        allow_redirects=False  # Prevent Flask from following redirects
    )
    # Create a Flask response with the target's response content and status code
    flask_response = Response(response.content, response.status_code, headers=response.headers.items())
    return flask_response

if __name__ == '__main__':
    app.run(debug=True,port=8080)  # Run the Flask app in debug mode